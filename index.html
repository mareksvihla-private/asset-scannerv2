<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AssetScan</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap');

:root {
  --bg: #f5f2eb;
  --surface: #ffffff;
  --surface2: #edeae2;
  --border: #d4cfc3;
  --accent: #1a6b3c;
  --accent-light: #e8f5ee;
  --accent2: #b85c00;
  --danger: #c0392b;
  --text: #1c1a16;
  --muted: #7a7060;
  --radius: 10px;
  --shadow: 0 2px 12px rgba(0,0,0,0.08);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'IBM Plex Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* HEADER */
header {
  background: var(--accent);
  color: white;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 56px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.logo {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 17px;
  font-weight: 600;
  letter-spacing: -0.5px;
  color: white;
}
.logo em { color: rgba(255,255,255,0.55); font-style: normal; }

.user-info {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  color: rgba(255,255,255,0.85);
}

.avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.4);
}

.btn-signout {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  font-family: 'IBM Plex Sans', sans-serif;
}

/* NAV */
.nav-bar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  padding: 0 16px;
  gap: 4px;
  overflow-x: auto;
}

.tab-btn {
  padding: 12px 16px;
  border: none;
  background: transparent;
  color: var(--muted);
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  white-space: nowrap;
  transition: all 0.15s;
}
.tab-btn.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}

/* VIEWS */
.view { display: none; padding: 18px; max-width: 680px; margin: 0 auto; }
.view.active { display: block; }

/* LOGIN SCREEN */
#login-screen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 30px 20px;
}

.login-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 40px 36px;
  max-width: 400px;
  width: 100%;
  text-align: center;
  box-shadow: var(--shadow);
}

.login-icon {
  width: 64px;
  height: 64px;
  background: var(--accent);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  margin: 0 auto 20px;
}

.login-card h1 {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 22px;
  margin-bottom: 6px;
  color: var(--text);
}

.login-card p {
  color: var(--muted);
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 28px;
}

.config-section {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 20px;
  text-align: left;
}

.config-section h3 {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--muted);
  font-family: 'IBM Plex Mono', monospace;
  margin-bottom: 12px;
}

.config-field { margin-bottom: 10px; }
.config-field label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px; }
.config-field input {
  width: 100%;
  padding: 9px 11px;
  border: 1px solid var(--border);
  border-radius: 7px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12px;
  background: var(--surface);
  color: var(--text);
}
.config-field input:focus { outline: none; border-color: var(--accent); }

.btn-google {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 13px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 9px;
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.15s;
}
.btn-google:hover { opacity: 0.9; }
.btn-google:disabled { opacity: 0.5; cursor: not-allowed; }

/* CARDS */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  box-shadow: var(--shadow);
  overflow: hidden;
}

.card-header {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  font-weight: 600;
  font-family: 'IBM Plex Mono', monospace;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* SCANNER */
.scanner-box {
  position: relative;
  width: 100%;
  aspect-ratio: 4/3;
  background: #111;
  overflow: hidden;
  max-height: 280px;
}

#interactive { width: 100%; height: 100%; }
#interactive video { width: 100% !important; height: 100% !important; object-fit: cover; }
#interactive canvas { display: none !important; }

.scanner-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}

.scan-reticle {
  width: 240px;
  height: 90px;
  border: 2px solid #4fffb0;
  border-radius: 8px;
  box-shadow: 0 0 0 2000px rgba(0,0,0,0.4);
  position: relative;
  display: none;
}

.scan-reticle::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: #4fffb0;
  animation: scanline 2s ease-in-out infinite;
  box-shadow: 0 0 8px #4fffb0;
}

@keyframes scanline {
  0%, 100% { top: 0; }
  50% { top: calc(100% - 2px); }
}

.scanner-placeholder {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  color: rgba(255,255,255,0.5);
  font-size: 13px;
}
.scanner-placeholder .big { font-size: 36px; }

.scanner-controls {
  padding: 12px 16px;
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

/* BUTTONS */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 16px;
  border-radius: 7px;
  border: none;
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { opacity: 0.88; }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }
.btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
.btn-outline:hover { border-color: var(--accent); color: var(--accent); }
.btn-danger { background: var(--danger); color: white; }
.btn-sm { padding: 7px 12px; font-size: 13px; }
.btn-amber { background: var(--accent2); color: white; }

/* FORM */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  padding: 16px;
}

.form-group { display: flex; flex-direction: column; gap: 5px; }
.form-group.full { grid-column: 1 / -1; }

label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.7px;
  color: var(--muted);
  font-family: 'IBM Plex Mono', monospace;
}

input[type=text], input[type=date], select, textarea {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 7px;
  color: var(--text);
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 15px;
  padding: 9px 11px;
  transition: border-color 0.2s;
  -webkit-appearance: none;
  width: 100%;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent);
  background: white;
}
select option { background: white; }
textarea { resize: vertical; min-height: 70px; }

.form-actions { padding: 0 16px 16px; display: flex; gap: 10px; flex-wrap: wrap; }

/* STATUS */
.status-bar {
  padding: 11px 14px;
  border-radius: 8px;
  font-size: 13px;
  font-family: 'IBM Plex Mono', monospace;
  display: none;
  align-items: center;
  gap: 8px;
  margin-bottom: 14px;
}
.status-bar.success { display: flex; background: var(--accent-light); color: var(--accent); border: 1px solid #b8dfc9; }
.status-bar.error { display: flex; background: #fdf0ef; color: var(--danger); border: 1px solid #f5c6c2; }
.status-bar.info { display: flex; background: #fff8ee; color: var(--accent2); border: 1px solid #f5ddb8; }
.status-bar.loading { display: flex; background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

/* FOUND ASSET BANNER */
.found-banner {
  display: none;
  background: #fff8ee;
  border: 1px solid #f5ddb8;
  border-radius: 8px;
  padding: 12px 14px;
  margin-bottom: 14px;
  font-size: 13px;
  color: var(--accent2);
  gap: 8px;
  align-items: center;
}
.found-banner.show { display: flex; }

/* ASSETS LIST */
.assets-toolbar {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 14px;
  flex-wrap: wrap;
}

.search-wrap {
  flex: 1;
  min-width: 160px;
  position: relative;
}
.search-wrap input { padding-left: 34px; font-size: 14px; }
.search-wrap::before {
  content: 'ğŸ”';
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 13px;
  pointer-events: none;
  z-index: 1;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  text-align: center;
}
.stat-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 24px;
  font-weight: 600;
  color: var(--accent);
  line-height: 1;
}
.stat-label { font-size: 11px; color: var(--muted); margin-top: 4px; }

.asset-list { display: flex; flex-direction: column; gap: 8px; }

.asset-row {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px 14px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.asset-row:hover { border-color: var(--accent); box-shadow: 0 2px 8px rgba(26,107,60,0.1); }

.asset-type-badge {
  width: 38px;
  height: 38px;
  border-radius: 8px;
  background: var(--accent-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}

.asset-info { flex: 1; min-width: 0; }
.asset-name {
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.asset-sub {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--muted);
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 3px;
}
.chip {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 1px 6px;
}

.asset-date-col {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--muted);
  text-align: right;
  flex-shrink: 0;
}

.empty {
  text-align: center;
  padding: 50px 20px;
  color: var(--muted);
}
.empty .big { font-size: 42px; margin-bottom: 10px; }

/* MODAL */
.overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 300;
  align-items: flex-end;
  justify-content: center;
  padding: 20px;
}
.overlay.open { display: flex; }

@media (min-width: 500px) {
  .overlay { align-items: center; }
  .sheet { border-radius: 14px !important; max-height: 85vh; }
}

.sheet {
  background: var(--surface);
  border-radius: 18px 18px 0 0;
  width: 100%;
  max-width: 520px;
  max-height: 90vh;
  overflow-y: auto;
}

.sheet-header {
  padding: 16px 18px 12px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  background: var(--surface);
}
.sheet-header h3 { font-size: 15px; font-weight: 600; }
.close-btn {
  width: 28px; height: 28px;
  border-radius: 50%;
  border: none;
  background: var(--surface2);
  color: var(--muted);
  cursor: pointer;
  font-size: 14px;
  display: flex; align-items: center; justify-content: center;
}

.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  padding: 16px 18px;
}
.detail-item { display: flex; flex-direction: column; gap: 3px; }
.detail-item.full { grid-column: 1 / -1; }
.d-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.7px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; }
.d-value {
  font-size: 13px;
  font-family: 'IBM Plex Mono', monospace;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 7px 9px;
  word-break: break-all;
  color: var(--text);
}

.sheet-actions { padding: 0 18px 18px; display: flex; gap: 8px; }

/* SPINNER */
.spin {
  display: inline-block;
  width: 14px; height: 14px;
  border: 2px solid currentColor;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* SETUP VIEW */
.setup-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 14px;
}
.setup-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 6px; }
.setup-card p { font-size: 13px; color: var(--muted); line-height: 1.6; margin-bottom: 12px; }
.setup-card code {
  font-family: 'IBM Plex Mono', monospace;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2px 6px;
  font-size: 12px;
  word-break: break-all;
}

.step-num {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px; height: 22px;
  border-radius: 50%;
  background: var(--accent);
  color: white;
  font-size: 11px;
  font-weight: 600;
  margin-right: 6px;
  flex-shrink: 0;
}

.step { display: flex; align-items: flex-start; gap: 2px; margin-bottom: 10px; font-size: 13px; line-height: 1.5; }

@media (max-width: 480px) {
  .form-grid { grid-template-columns: 1fr; }
  .form-group.full { grid-column: 1; }
  .detail-grid { grid-template-columns: 1fr; }
  .detail-item.full { grid-column: 1; }
  .stats-row { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-icon">ğŸ“¦</div>
    <h1>AssetScan</h1>
    <p>School asset tracking with Google Sheets sync. Sign in with your Google account to get started.</p>

    <div class="config-section">
      <h3>Configuration</h3>
      <div class="config-field">
        <label>Google Client ID</label>
        <input type="text" id="cfg-client-id" placeholder="xxxx.apps.googleusercontent.com" />
      </div>
      <div class="config-field">
        <label>Google Sheet ID</label>
        <input type="text" id="cfg-sheet-id" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgVE2upms" />
      </div>
      <div style="margin-top:8px;">
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:12px;color:var(--muted);">
          <input type="checkbox" id="cfg-remember" checked style="width:auto"> Remember these settings
        </label>
      </div>
    </div>

    <button class="btn-google" onclick="startSignIn()" id="signin-btn">
      <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#fff" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/><path fill="rgba(255,255,255,0.7)" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 009 18z"/><path fill="rgba(255,255,255,0.5)" d="M3.964 10.71A5.41 5.41 0 013.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 000 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="rgba(255,255,255,0.8)" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 00.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
      Sign in with Google
    </button>

    <p style="margin-top:14px;font-size:11px;color:var(--muted);">Need help setting this up? See the <strong>Setup Guide</strong> tab after signing in.</p>
  </div>
</div>

<!-- MAIN APP (hidden until signed in) -->
<div id="app" style="display:none">
  <header>
    <div class="logo">asset<em>scan</em></div>
    <div class="user-info">
      <img id="user-avatar" class="avatar" src="" alt="" style="display:none">
      <span id="user-name" style="display:none"></span>
      <button class="btn-signout" onclick="signOut()">Sign out</button>
    </div>
  </header>

  <nav class="nav-bar">
    <button class="tab-btn active" onclick="showView('scan',this)">ğŸ“· Scan</button>
    <button class="tab-btn" onclick="showView('assets',this)">ğŸ“‹ Assets</button>
    <button class="tab-btn" onclick="showView('setup',this)">âš™ï¸ Setup</button>
  </nav>

  <!-- SCAN VIEW -->
  <div class="view active" id="view-scan">
    <div id="status-msg" class="status-bar"></div>
    <div id="found-banner" class="found-banner">
      ğŸ” <span id="found-msg">Known asset found â€” details loaded. Review and confirm.</span>
    </div>

    <div class="card">
      <div class="card-header">ğŸ“· Barcode Scanner</div>
      <div class="scanner-box">
        <div class="scanner-placeholder" id="scan-placeholder">
          <div class="big">ğŸ“·</div>
          <span>Tap Start Camera to scan</span>
        </div>
        <div id="interactive"></div>
        <div class="scanner-overlay">
          <div class="scan-reticle" id="reticle"></div>
        </div>
      </div>
      <div class="scanner-controls">
        <button class="btn btn-primary" id="cam-btn" onclick="toggleCamera()">â–¶ Start Camera</button>
        <button class="btn btn-outline btn-sm" onclick="clearForm()">â†º New / Clear</button>
      </div>
    </div>

    <div class="card">
      <div class="card-header">âœï¸ Asset Details</div>
      <div class="form-grid">
        <div class="form-group full">
          <label>Barcode Number</label>
          <input type="text" id="f-barcode" placeholder="Scan above or type manuallyâ€¦" oninput="onBarcodeManualInput()" />
        </div>
        <div class="form-group">
          <label>Asset Number</label>
          <input type="text" id="f-asset-num" placeholder="e.g. A00123" />
        </div>
        <div class="form-group">
          <label>Asset Type</label>
          <select id="f-asset-type">
            <option value="">â€” Select â€”</option>
            <option>Laptop</option>
            <option>Desktop</option>
            <option>Chromebook</option>
            <option>iPad</option>
            <option>Monitor</option>
            <option>Printer</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Make</label>
          <select id="f-make">
            <option value="">â€” Select â€”</option>
            <option>Apple</option>
            <option>HP</option>
            <option>Dell</option>
            <option>Lenovo</option>
            <option>Acer</option>
            <option>Asus</option>
            <option>Samsung</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Model</label>
          <input type="text" id="f-model" placeholder="e.g. EliteBook 840" />
        </div>
        <div class="form-group">
          <label>Serial Number</label>
          <input type="text" id="f-serial" placeholder="e.g. SN12345678" />
        </div>
        <div class="form-group">
          <label>Location</label>
          <select id="f-location">
            <option value="">â€” Select â€”</option>
            <option>MR1001</option><option>MR1002</option><option>MR1003</option>
            <option>MR1004</option><option>MR1005</option><option>MR1006</option>
            <option>MR1007</option><option>MR1008</option><option>MR1009</option>
            <option>MR1010</option><option>MR1011</option><option>MR1012</option>
            <option>Library</option><option>Staff Room</option><option>Office</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Date Sighted</label>
          <input type="date" id="f-date" readonly style="background:#edeae2;color:var(--muted)" />
        </div>
        <div class="form-group full">
          <label>Comments</label>
          <textarea id="f-comments" placeholder="Condition, issues, notesâ€¦"></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-primary" id="save-btn" onclick="saveAsset()">
          âœ“ Save to Sheet
        </button>
        <button class="btn btn-outline" onclick="clearForm()">âœ• Clear</button>
      </div>
    </div>
  </div>

  <!-- ASSETS VIEW -->
  <div class="view" id="view-assets">
    <div class="stats-row" id="stats-row">
      <div class="stat-card"><div class="stat-num" id="stat-total">â€”</div><div class="stat-label">Total Assets</div></div>
      <div class="stat-card"><div class="stat-num" id="stat-today">â€”</div><div class="stat-label">Seen Today</div></div>
      <div class="stat-card"><div class="stat-num" id="stat-types">â€”</div><div class="stat-label">Asset Types</div></div>
    </div>

    <div class="assets-toolbar">
      <div class="search-wrap">
        <input type="text" id="search-input" placeholder="Search assetsâ€¦" oninput="filterAssets()" />
      </div>
      <button class="btn btn-primary btn-sm" onclick="loadSheet()">â†» Refresh</button>
    </div>

    <div id="asset-list-wrap"></div>
  </div>

  <!-- SETUP VIEW -->
  <div class="view" id="view-setup">
    <div class="setup-card">
      <h3>How this app works</h3>
      <p>AssetScan uses the Google Sheets API to read and write asset data directly to a spreadsheet in your Google Drive. Every scan updates the sheet in real time. Multiple staff can use the app from different devices and they all see the same data.</p>
    </div>

    <div class="setup-card">
      <h3>Step-by-step: Google Cloud Setup</h3>
      <div class="step"><span class="step-num">1</span><span>Go to <strong>console.cloud.google.com</strong> and sign in with your school Google account.</span></div>
      <div class="step"><span class="step-num">2</span><span>Create a new project (e.g. <em>AssetScan</em>).</span></div>
      <div class="step"><span class="step-num">3</span><span>Go to <strong>APIs & Services â†’ Library</strong> and enable the <strong>Google Sheets API</strong>.</span></div>
      <div class="step"><span class="step-num">4</span><span>Go to <strong>APIs & Services â†’ OAuth consent screen</strong>. Choose <em>External</em>, fill in App Name (<em>AssetScan</em>), support email, then Save.</span></div>
      <div class="step"><span class="step-num">5</span><span>Under <strong>Scopes</strong>, add <code>https://www.googleapis.com/auth/spreadsheets</code>. Save.</span></div>
      <div class="step"><span class="step-num">6</span><span>Under <strong>Test users</strong>, add the email addresses of all staff who will use the app. Save.</span></div>
      <div class="step"><span class="step-num">7</span><span>Go to <strong>APIs & Services â†’ Credentials â†’ Create Credentials â†’ OAuth Client ID</strong>. Choose <em>Web application</em>.</span></div>
      <div class="step"><span class="step-num">8</span><span>Under <strong>Authorised JavaScript origins</strong>, add the URL where the app is hosted (e.g. your GitHub Pages URL or <code>http://localhost</code> for testing).</span></div>
      <div class="step"><span class="step-num">9</span><span>Copy the <strong>Client ID</strong> â€” it ends in <code>.apps.googleusercontent.com</code>. Paste it in the login screen.</span></div>
      <div class="step"><span class="step-num">10</span><span>Create a new Google Sheet in your Drive. Copy its ID from the URL (the long string between <code>/d/</code> and <code>/edit</code>). Paste it in the login screen.</span></div>
      <div class="step"><span class="step-num">11</span><span>Share the Google Sheet with all staff who need access (Editor permission).</span></div>
    </div>

    <div class="setup-card">
      <h3>Current Configuration</h3>
      <p>Client ID: <code id="cfg-display-cid">â€”</code></p>
      <p style="margin-top:8px;">Sheet ID: <code id="cfg-display-sid">â€”</code></p>
      <p style="margin-top:8px;">Sheet URL: <a id="cfg-sheet-link" href="#" target="_blank" style="font-size:13px;color:var(--accent)">Open Google Sheet â†—</a></p>
    </div>

    <div class="setup-card">
      <h3>Customise Room List</h3>
      <p>Edit the HTML file and find the <code>f-location</code> select element to add or change room numbers.</p>
    </div>
  </div>
</div>

<!-- ASSET DETAIL MODAL -->
<div class="overlay" id="detail-overlay">
  <div class="sheet">
    <div class="sheet-header">
      <h3 id="modal-title">Asset Details</h3>
      <button class="close-btn" onclick="closeModal()">âœ•</button>
    </div>
    <div class="detail-grid" id="modal-body"></div>
    <div class="sheet-actions">
      <button class="btn btn-outline btn-sm" onclick="editFromModal()">âœ Edit / Rescan</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
const DISCOVERY_DOCS = ['https://sheets.googleapis.com/$discovery/rest?version=v4'];
const SHEET_NAME = 'Assets';
const HEADERS = ['Barcode','Asset Number','Asset Type','Make','Model','Serial Number','Location','Date Sighted','Comments','Row Updated'];

const FIELDS  = ['barcode','assetNum','assetType','make','model','serial','location','date','comments'];
const FORM_IDS = ['f-barcode','f-asset-num','f-asset-type','f-make','f-model','f-serial','f-location','f-date','f-comments'];
const LABELS  = ['Barcode','Asset Number','Asset Type','Make','Model','Serial Number','Location','Date Sighted','Comments'];

let tokenClient, gapiInited = false, gisInited = false;
let sheetData = []; // local cache [{rowIndex, ...fields}]
let scannerRunning = false;
let currentModalRow = null;
let barcodeInputTimer = null;

// â”€â”€â”€ STARTUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload = () => {
  loadConfig();
  setTodayDate();
};

function setTodayDate() {
  document.getElementById('f-date').value = todayStr();
}

function todayStr() {
  return new Date().toISOString().split('T')[0];
}

function loadConfig() {
  const cid = localStorage.getItem('assetscan_cid') || '';
  const sid = localStorage.getItem('assetscan_sid') || '';
  if (cid) document.getElementById('cfg-client-id').value = cid;
  if (sid) document.getElementById('cfg-sheet-id').value = sid;
}

// â”€â”€â”€ GOOGLE SIGN IN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startSignIn() {
  const clientId = document.getElementById('cfg-client-id').value.trim();
  const sheetId  = document.getElementById('cfg-sheet-id').value.trim();

  if (!clientId || !sheetId) {
    alert('Please enter your Google Client ID and Sheet ID first.');
    return;
  }

  if (document.getElementById('cfg-remember').checked) {
    localStorage.setItem('assetscan_cid', clientId);
    localStorage.setItem('assetscan_sid', sheetId);
  }

  const btn = document.getElementById('signin-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> Loading Google APIsâ€¦';

  // Load GAPI
  await loadScript('https://apis.google.com/js/api.js');
  await new Promise(res => gapi.load('client', res));
  await gapi.client.init({ discoveryDocs: DISCOVERY_DOCS });
  gapiInited = true;

  // Load GIS
  await loadScript('https://accounts.google.com/gsi/client');
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: clientId,
    scope: SCOPES,
    callback: onTokenReceived
  });
  gisInited = true;

  tokenClient.requestAccessToken({ prompt: 'consent' });
}

async function onTokenReceived(resp) {
  if (resp.error) {
    alert('Sign-in failed: ' + resp.error);
    document.getElementById('signin-btn').disabled = false;
    document.getElementById('signin-btn').textContent = 'Sign in with Google';
    return;
  }

  // Get user profile
  try {
    const info = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
      headers: { Authorization: 'Bearer ' + gapi.client.getToken().access_token }
    }).then(r => r.json());
    if (info.picture) {
      document.getElementById('user-avatar').src = info.picture;
      document.getElementById('user-avatar').style.display = '';
    }
    if (info.name) {
      document.getElementById('user-name').textContent = info.name;
      document.getElementById('user-name').style.display = '';
    }
  } catch(e) {}

  showApp();
  await ensureSheetReady();
  await loadSheet();
}

function loadScript(src) {
  return new Promise((res, rej) => {
    const s = document.createElement('script');
    s.src = src;
    s.onload = res;
    s.onerror = rej;
    document.head.appendChild(s);
  });
}

function signOut() {
  if (gapi.client.getToken()) {
    google.accounts.oauth2.revoke(gapi.client.getToken().access_token, () => {});
    gapi.client.setToken('');
  }
  sheetData = [];
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
}

function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = '';
  // Show config in setup tab
  const cid = localStorage.getItem('assetscan_cid') || '';
  const sid = localStorage.getItem('assetscan_sid') || '';
  document.getElementById('cfg-display-cid').textContent = cid || 'â€”';
  document.getElementById('cfg-display-sid').textContent = sid || 'â€”';
  if (sid) {
    document.getElementById('cfg-sheet-link').href = `https://docs.google.com/spreadsheets/d/${sid}/edit`;
  }
}

// â”€â”€â”€ SHEET SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getSheetId() {
  return localStorage.getItem('assetscan_sid') || '';
}

async function ensureSheetReady() {
  try {
    const sid = getSheetId();
    // Check if sheet exists
    const res = await gapi.client.sheets.spreadsheets.get({ spreadsheetId: sid });
    const sheets = res.result.sheets.map(s => s.properties.title);
    if (!sheets.includes(SHEET_NAME)) {
      // Create the sheet
      await gapi.client.sheets.spreadsheets.batchUpdate({
        spreadsheetId: sid,
        resource: { requests: [{ addSheet: { properties: { title: SHEET_NAME } } }] }
      });
      // Add headers
      await gapi.client.sheets.spreadsheets.values.update({
        spreadsheetId: sid,
        range: `${SHEET_NAME}!A1`,
        valueInputOption: 'RAW',
        resource: { values: [HEADERS] }
      });
    }
  } catch(e) {
    console.error('Sheet setup error', e);
  }
}

// â”€â”€â”€ LOAD SHEET DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSheet() {
  showStatus('loading', 'âŸ³ Loading from Google Sheetsâ€¦');
  try {
    const res = await gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: getSheetId(),
      range: `${SHEET_NAME}!A1:J10000`
    });
    const rows = res.result.values || [];
    if (rows.length <= 1) { sheetData = []; }
    else {
      sheetData = rows.slice(1).map((r, i) => ({
        rowIndex: i + 2, // 1-indexed, row 1 is header
        barcode:   r[0] || '',
        assetNum:  r[1] || '',
        assetType: r[2] || '',
        make:      r[3] || '',
        model:     r[4] || '',
        serial:    r[5] || '',
        location:  r[6] || '',
        date:      r[7] || '',
        comments:  r[8] || '',
        updated:   r[9] || ''
      }));
    }
    hideStatus();
    renderAssetList();
    updateStats();
  } catch(e) {
    showStatus('error', 'âœ• Failed to load sheet: ' + (e.result?.error?.message || e.message || 'Unknown error'));
  }
}

// â”€â”€â”€ SCANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleCamera() {
  scannerRunning ? stopCamera() : startCamera();
}

function startCamera() {
  document.getElementById('scan-placeholder').style.display = 'none';
  document.getElementById('reticle').style.display = 'block';
  document.getElementById('cam-btn').textContent = 'â–  Stop Camera';

  let lastCode = '', hitCount = 0;

  Quagga.init({
    inputStream: {
      name: 'Live',
      type: 'LiveStream',
      target: document.getElementById('interactive'),
      constraints: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
    },
    decoder: {
      readers: ['code_128_reader','ean_reader','ean_8_reader','code_39_reader','upc_reader','upc_e_reader','i2of5_reader','code_93_reader']
    },
    locate: true
  }, err => {
    if (err) {
      showStatus('error', 'âœ• Camera error: ' + err.message);
      resetCameraUI();
      return;
    }
    Quagga.start();
    scannerRunning = true;
  });

  Quagga.onDetected(result => {
    const code = result.codeResult.code;
    if (code === lastCode) { hitCount++; } else { lastCode = code; hitCount = 1; }
    if (hitCount === 3) {
      hitCount = 0;
      onBarcodeScanned(code);
    }
  });
}

function stopCamera() {
  Quagga.stop();
  scannerRunning = false;
  document.getElementById('interactive').innerHTML = '';
  resetCameraUI();
}

function resetCameraUI() {
  document.getElementById('scan-placeholder').style.display = 'flex';
  document.getElementById('reticle').style.display = 'none';
  document.getElementById('cam-btn').textContent = 'â–¶ Start Camera';
  scannerRunning = false;
}

async function onBarcodeScanned(code) {
  document.getElementById('f-barcode').value = code;
  const existing = sheetData.find(a => a.barcode === code);
  if (existing) {
    loadExistingAsset(existing);
  } else {
    setTodayDate();
    showStatus('info', 'âœ¦ New barcode â€” fill in details and save.');
    hideBanner();
  }
}

function onBarcodeManualInput() {
  clearTimeout(barcodeInputTimer);
  barcodeInputTimer = setTimeout(() => {
    const code = document.getElementById('f-barcode').value.trim();
    if (code.length >= 3) onBarcodeScanned(code);
  }, 600);
}

function loadExistingAsset(asset) {
  FIELDS.forEach((f, i) => {
    const el = document.getElementById(FORM_IDS[i]);
    if (f === 'date') {
      el.value = todayStr(); // always update to today
    } else {
      el.value = asset[f] || '';
    }
  });
  // Store row reference for updating
  document.getElementById('f-barcode').dataset.rowIndex = asset.rowIndex;
  showBanner(`ğŸ” Known asset found: ${asset.make} ${asset.model || asset.assetType}. Date updated to today â€” review and confirm.`);
  showStatus('info', 'â†‘ Existing asset loaded â€” review details below and tap Save.');
}

function showBanner(msg) {
  const b = document.getElementById('found-banner');
  document.getElementById('found-msg').textContent = msg;
  b.classList.add('show');
}
function hideBanner() {
  document.getElementById('found-banner').classList.remove('show');
}

// â”€â”€â”€ SAVE ASSET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveAsset() {
  const barcode = document.getElementById('f-barcode').value.trim();
  const assetNum = document.getElementById('f-asset-num').value.trim();
  if (!barcode && !assetNum) {
    showStatus('error', 'âœ• Please enter a barcode or asset number.');
    return;
  }

  const btn = document.getElementById('save-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> Savingâ€¦';
  showStatus('loading', 'âŸ³ Saving to Google Sheetsâ€¦');

  const values = [
    barcode,
    document.getElementById('f-asset-num').value.trim(),
    document.getElementById('f-asset-type').value,
    document.getElementById('f-make').value,
    document.getElementById('f-model').value.trim(),
    document.getElementById('f-serial').value.trim(),
    document.getElementById('f-location').value,
    document.getElementById('f-date').value,
    document.getElementById('f-comments').value.trim(),
    new Date().toLocaleString()
  ];

  try {
    const existingRowIndex = document.getElementById('f-barcode').dataset.rowIndex;

    if (existingRowIndex) {
      // UPDATE existing row
      await gapi.client.sheets.spreadsheets.values.update({
        spreadsheetId: getSheetId(),
        range: `${SHEET_NAME}!A${existingRowIndex}:J${existingRowIndex}`,
        valueInputOption: 'RAW',
        resource: { values: [values] }
      });
      showStatus('success', 'âœ“ Asset updated in Google Sheet!');
    } else {
      // APPEND new row
      await gapi.client.sheets.spreadsheets.values.append({
        spreadsheetId: getSheetId(),
        range: `${SHEET_NAME}!A1`,
        valueInputOption: 'RAW',
        insertDataOption: 'INSERT_ROWS',
        resource: { values: [values] }
      });
      showStatus('success', 'âœ“ New asset saved to Google Sheet!');
    }

    await loadSheet();
    clearForm();
  } catch(e) {
    showStatus('error', 'âœ• Save failed: ' + (e.result?.error?.message || e.message || 'Check permissions'));
  }

  btn.disabled = false;
  btn.innerHTML = 'âœ“ Save to Sheet';
}

// â”€â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clearForm() {
  FORM_IDS.forEach(id => {
    const el = document.getElementById(id);
    if (el.tagName === 'SELECT') el.value = '';
    else el.value = '';
  });
  document.getElementById('f-barcode').dataset.rowIndex = '';
  setTodayDate();
  hideBanner();
  hideStatus();
}

// â”€â”€â”€ ASSET LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAssetList() {
  const query = (document.getElementById('search-input')?.value || '').toLowerCase();
  const filtered = query
    ? sheetData.filter(a => Object.values(a).some(v => String(v).toLowerCase().includes(query)))
    : sheetData;

  const wrap = document.getElementById('asset-list-wrap');

  if (!filtered.length) {
    wrap.innerHTML = `<div class="empty"><div class="big">ğŸ“¦</div><p>${sheetData.length ? 'No results match your search.' : 'No assets yet. Start scanning!'}</p></div>`;
    return;
  }

  const icons = { Laptop:'ğŸ’»', Desktop:'ğŸ–¥ï¸', Chromebook:'ğŸ”µ', iPad:'ğŸ“±', Monitor:'ğŸ–¥', Printer:'ğŸ–¨ï¸', Other:'ğŸ“¦' };

  wrap.innerHTML = `<div class="asset-list">${filtered.map((a, i) => `
    <div class="asset-row" onclick="openModal(${sheetData.indexOf(a)})">
      <div class="asset-type-badge">${icons[a.assetType] || 'ğŸ“¦'}</div>
      <div class="asset-info">
        <div class="asset-name">${a.make || ''} ${a.model || a.assetType || 'Unknown'}</div>
        <div class="asset-sub">
          ${a.barcode ? `<span class="chip">#${a.barcode}</span>` : ''}
          ${a.assetNum ? `<span class="chip">ğŸ·${a.assetNum}</span>` : ''}
          ${a.location ? `<span class="chip">ğŸ“${a.location}</span>` : ''}
        </div>
      </div>
      <div class="asset-date-col">${a.date || 'â€”'}</div>
    </div>`).join('')}
  </div>`;
}

function filterAssets() {
  renderAssetList();
}

function updateStats() {
  const today = todayStr();
  document.getElementById('stat-total').textContent = sheetData.length;
  document.getElementById('stat-today').textContent = sheetData.filter(a => a.date === today).length;
  const types = new Set(sheetData.map(a => a.assetType).filter(Boolean));
  document.getElementById('stat-types').textContent = types.size;
}

// â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(idx) {
  currentModalRow = idx;
  const a = sheetData[idx];
  document.getElementById('modal-title').textContent = `${a.make || ''} ${a.model || a.assetType || 'Asset'}`.trim();
  document.getElementById('modal-body').innerHTML = FIELDS.map((f, i) => `
    <div class="detail-item ${f === 'comments' ? 'full' : ''}">
      <div class="d-label">${LABELS[i]}</div>
      <div class="d-value">${a[f] || 'â€”'}</div>
    </div>`).join('');
  document.getElementById('detail-overlay').classList.add('open');
}

function closeModal() {
  document.getElementById('detail-overlay').classList.remove('open');
  currentModalRow = null;
}

function editFromModal() {
  if (currentModalRow === null) return;
  const a = sheetData[currentModalRow];
  FIELDS.forEach((f, i) => {
    const el = document.getElementById(FORM_IDS[i]);
    el.value = f === 'date' ? todayStr() : (a[f] || '');
  });
  document.getElementById('f-barcode').dataset.rowIndex = a.rowIndex;
  showBanner(`Editing: ${a.make} ${a.model || a.assetType}. Date updated to today.`);
  closeModal();
  showView('scan', document.querySelectorAll('.tab-btn')[0]);
}

document.getElementById('detail-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('detail-overlay')) closeModal();
});

// â”€â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showView(name, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'assets') { renderAssetList(); updateStats(); }
}

// â”€â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let statusTimer;
function showStatus(type, msg) {
  const el = document.getElementById('status-msg');
  el.className = 'status-bar ' + type;
  el.textContent = msg;
  clearTimeout(statusTimer);
  if (type === 'success') statusTimer = setTimeout(hideStatus, 4000);
}
function hideStatus() {
  const el = document.getElementById('status-msg');
  if (el) el.className = 'status-bar';
}
</script>
</body>
</html>
